var appConfig = appConfig || {};
appConfig = {
   WEBSITE_URL: 'http://jokesforkids.herokuapp.com',
  	//WEBSITE_URL: 'http://localhost:8000',
    WEBAPI_URL : 'http://kejokesapi.herokuapp.com',
   // WEBAPI_URL : 'http://localhost:3000',
    FILE_UPLOAD_URL: 'https://elasticbeanstalk-us-west-2-780260980507.s3.amazonaws.com/'
    
};
(function(){
	angular
		.module('app',['ui.router',
			'jokes-main.controller',
			'jokes-most-liked.controller',
			'jokes-post.controller',
			'feedback.controller',
			'jokes-main.service',
			'feedback.service'
		])
		.config(appConfig);
		appConfig.$inject = ['$stateProvider'];

		function appConfig($stateProvider){
				$stateProvider
					.state('home',{
						url: '/',
						templateUrl: 'jokes/jokes-list.html',
						controller: 'JokesMainController',
						controllerAs: 'vm'
					})
					.state('mostLiked',{
						url: '/mostliked',
						templateUrl: 'jokes/jokes-most-liked.html',
						controller: 'JokesMostLikedController',
						controllerAs: 'vm'
					})
					.state('submitJokes',{
						url: '/submitjokes',
						templateUrl: 'views/jokes-post.html',
						controller: 'JokesPostController',
						controllerAs: 'vm'
					})
					.state('contactUs',{
						url: '/contactus',
						templateUrl: 'views/contact-us.html'
					})
					.state('postFeedback',{
						url: '/postfeedback',
						templateUrl: 'views/feedback-post.html',
						controller: 'FeedbackController'
					});
		}

})();
(function(){
	'use strict';
	angular
		.module('review.controller',[])
		.controller('ReviewController',ReviewController);
	ReviewController.$inject = ['reviewService'];
	function ReviewController(reviewService){
		var vm = this;
		vm.jokesList = reviewService.getJokeList.query();
		vm.predicate = '-date_created';
		vm.saveReview = saveReview(id);

		function saveReview(id){
			var reviewObj = $.grep(vm.jokesList.jokes, function (e) { return e._id == id; });

			var joke = JSON.stringify({id : reviewObj[0]._id ,description : reviewObj[0].description, isReviewed : reviewObj[0].is_reviewed, userEmail : reviewObj[0].user_email, jokeCategory: reviewObj[0].joke_category  });
			reviewService.updateJokeReview.save(joke);
		}
	}
})();



(function(){
	'use strict';
    angular
      .module('review.service',['ngResource'])
      .factory('reviewService', reviewService);
    reviewService.$inject = ['$resource'];
	function reviewService($resource){
		return{
			getJokeList : $resource(appConfig.WEBAPI_URL + '/admn/review',{},{query: {method: 'GET'}}),
			updateJokeReview : $resource(appConfig.WEBAPI_URL + '/admn/review/update', {},{save: {method: 'PUT' , headers: { 'Content-Type': 'application/json'}}})
		};
	}
	
})();
(function() {
	'use strict';
	angular
		.module('video-review.controller',[])
		.controller('VideoReviewController', VideoReviewController);
	VideoReviewController.$inject = ['$sce', 'videoReviewService'];
	function VideoReviewController($sce, videoReviewService) {
		var vm = this;
		vm.saveVideoReview = saveVideoReview(id);
		vm.trustSrc = trustSrc(src);
		vm.videoListForReview = videoReviewService.getVideoForReview.query();

		function saveVideoReview(id) {

			var reviewObj = $.grep($scope.videoListForReview.message, function (e) {
				return e.file_id == id;
			});

			var video = JSON.stringify({
				file_id: reviewObj[0].file_id,
				description: reviewObj[0].description,
				isReviewed: reviewObj[0].is_reviewed,
				title: reviewObj[0].title,
				tags: reviewObj[0].tags
			});
			videoReviewService.UpdateVideoForReview.save(video);
			// use notification service here  COMMON.showGlobalMessageAlert("Save successfully!")
		}

		function trustSrc(src) {
			return $sce.trustAsResourceUrl(src);
		}

	}
})();


(function(){
	'use strict';
    angular
      .module('video-review.service',['ngResource'])
      .factory('videoReviewService', videoReviewService);
    videoReviewService.$inject = ['$resource'];
	function videoReviewService($resource){
		return{
			getVideoForReview : $resource(appConfig.WEBAPI_URL + '/video/review',{},{query: {method: 'GET'}}) ,
			updateVideoForReview : $resource(appConfig.WEBAPI_URL + '/video/review/update', {},{save: {method: 'PUT' , headers: { 'Content-Type': 'application/json'}}})
		};
	}
})();
(function(){
    'use strict';
    angular
        .module('feedback.controller',[])
        .controller('FeedbackController', FeedbackController);
    FeedbackController.$inject = ['feedbackService'];
    function  FeedbackController(feedbackService){
        var vm = this;
        vm.submit = submit;
        function submit(){
            var feedback = JSON.stringify({description : vm.description, contact_no : vm.contact_no, user_email : vm.user_email});
            //   newCard.description = "Mike Smith";
            feedbackService.createFeedback.save(feedback);

            //use notification service and use success, failure//COMMON.showGlobalMessageAlert("Thanks for you feed back! please <a href='#/'>click here </a> to go to the jokes list ");
        }
    }
})();

(function(){
	'use strict';
  angular
    .module('feedback.service',['ngResource'])
    .factory('feedbackService', feedbackService);
  feedbackService.$inject = ['$resource'];
  function feedbackService($resource){
     return {
    	createFeedback: $resource(appConfig.WEBAPI_URL + '/feedbacks/create', {},{save: {method: 'POST' , headers: { 'Content-Type': 'application/json'}}})
  	};
  }
})();


/**
 * Created by dkhetwal on 12/11/2015.
 */
(function(){
    angular
        .module('exception.config',[])
        .config(exceptionConfig);
    exceptionConfig.$inject = ['$provide'];
    function exceptionConfig($provide){
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    }
    extendExceptionHandler.$inject = ['$delegate','$log'];

    function extendExceptionHandler($delegate, $log){
        // send error log to backend service
        return function(exception, cause){
            $delegate(exception, cause);
            var errorData = {
                exception: exception,
                cause:cause
            };
        };
    }
})();
/**
 * Created by dkhetwal on 12/11/2015.
 */
(function(){
    'use strict';
    angular
        .module('notification.service',[])
        .factory('notificationService',notificationService);
        notificationService.$inject = ['logger'];
        function notificationService(logger){
            var service = {
                info: info,
                error: error
            };
            return service;
            function info(message){
                toastr.info(message);
            }
            function error(message){
                toastr.error(message);
            }
        }
})();
(function(){
    'use strict';
    angular
        .module('jokes-main.controller',[])
        .controller('JokesMainController', JokesMainController);
    JokesMainController.$inject = ['$location','$filter','jokesMainService'];
    function JokesMainController($location,$filter,jokesMainService){

        var vm = this;
        vm.dataLoaded = false;
        vm.jokesList = [];
        vm.postLike = postLike;
        loadJokes();
        function loadJokes() {
            vm.dataLoaded = false;
            jokesMainService.getJokeList
                .query(function(data){
                    vm.jokesList = data;
                    vm.dataLoaded = true;
            });
        }

        function postLike(){
            debugger;
            /*var joke = JSON.stringify({id : id , is_liked : true});
            jokesMainService.PostLike.save(joke);
            var _numLikes = parseInt($("#cnt"+ id).text()) + 1;
            $("#cnt"+ id).text(_numLikes);  // remove jquery code
            $("#"+ id).show(); */
        }

    }
})();



(function(){
    'use strict';
    angular
      .module('jokes-main.service',['ngResource'])
      .factory('jokesMainService', jokesMainService);
    jokesMainService.$inject = ['$resource'];
    function jokesMainService($resource){
      return {
    	getJokeList : $resource(appConfig.WEBAPI_URL + '/jokes', {}, {query: {method:'GET'}}),
        getMostLikedList : $resource(appConfig.WEBAPI_URL + '/jokes/mostliked',{}, {query: {method: 'GET'}}),
    	createJoke: $resource(appConfig.WEBAPI_URL + '/jokes/create', {},{save: {method: 'POST' , headers: { 'Content-Type': 'application/json'}}}),
        postLike : $resource(appConfig.WEBAPI_URL + '/jokes/createlike', {},{save: {method: 'PUT' , headers: { 'Content-Type': 'application/json'}}})
	   };
    }
  })();


(function(){
    'use strict';
    angular
        .module('jokes-most-liked.controller',[])
        .controller('JokesMostLikedController',JokesMostLikedController);
    JokesMostLikedController.$inject = ['jokesMainService'];
    function JokesMostLikedController(jokesMainService){
        var vm = this;
        vm.dataLoaded = false;
        vm.jokesList = [];
        vm.postLike = postLike;
        loadJokes();
        function loadJokes(){
            $scope.jokesList = jokesMainService.GetMostLikedList.query(function(){$scope.dataLoaded = true;});
        }
        function postLike(id){
            var joke = JSON.stringify({id : id , is_liked : true});
            jokesMainService.PostLike.save(joke);
            var _numLikes = parseInt($("#cnt"+ id).text()) + 1;
            $("#cnt"+ id).text(_numLikes);
            $("#"+ id).show();
        }
    }
})();


/**
 * Created by dkhetwal on 12/11/2015.
 */
(function () {
    'use strict';
    angular
        .module('jokes-post.controller',[])
        .controller('JokesPostController', JokesPostController);
    JokesPostController.$inject = ['jokesMainService'];
    function JokesPostController(jokesMainService){
        var vm = this;
        vm.submitJoke = submitJoke;
        function submitJoke(){
            var joke = JSON.stringify({description : vm.jokeDescription, joke_category : vm.jokeCategory, user_email : vm.userEmail});
            jokesMainService.createJoke.save(joke, function(data){

            },function(error){

            });
            vm.jokeDescription = "";
            COMMON.showGlobalMessageAlert("Your joke submitted successfully!. will be posted after being reviewed. You can post another Joke on the same screen.");
        }
    }
})();